/**
 * Vercel Serverless Function Handler
 * This file is used by Vercel to handle all API requests
 */

import { app } from '../src/lib/socket.js';
import { createApp } from '../src/app.js';
import { connectDb } from '../src/lib/database.js';

// Initialize the Express app with routes
createApp(app);

// Connect to database (this will be cached in serverless environment)
let dbConnected = false;
const connectDbOnce = async () => {
    if (!dbConnected) {
        try {
            await connectDb();
            dbConnected = true;
        } catch (error) {
            console.error('Database connection error:', error);
        }
    }
};

// Initialize database connection
connectDbOnce().catch(console.error);

// Export the Express app as Vercel serverless function
export default app;

